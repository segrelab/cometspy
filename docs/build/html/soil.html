<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Soil-air interface &mdash; COMETSpy  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Simulating growth on Petri dish" href="petri_dish.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/cometspy_logo_white_bkgd.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Package Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#what-is-cometspy">What is COMETSpy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#how-to-use-this-documentation">How to use this Documentation:</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#cite-us">Cite Us:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installation-of-comets">Installation of COMETS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="capabilities.html">COMETS Capabilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="capabilities.html#capabilities-in-space">Capabilities in space</a></li>
<li class="toctree-l2"><a class="reference internal" href="capabilities.html#biological-capabilities">Biological capabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="capabilities.html#computational-capabilities">Computational capabilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#preparing-a-model-for-comets">Preparing a model for <code class="docutils literal notranslate"><span class="pre">COMETS</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#setting-comets-simulation-parameters">Setting <code class="docutils literal notranslate"><span class="pre">COMETS</span></code> simulation parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="getting_started.html#preparing-a-comets-simulation-layout">Preparing a <code class="docutils literal notranslate"><span class="pre">COMETS</span></code> simulation layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started.html#running-a-comets-simulation">Running a <code class="docutils literal notranslate"><span class="pre">COMETS</span></code> simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started.html#checking-simulation-output-and-possible-errors">Checking simulation output and possible errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started.html#accessing-the-results-of-the-simulation">Accessing the results of the simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_tube.html">Growth in a test tube</a><ul>
<li class="toctree-l2"><a class="reference internal" href="test_tube.html#loading-the-comets-python-toolbox">Loading the COMETS Python Toolbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_tube.html#creating-a-test-tube">Creating a test tube</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_tube.html#loading-a-model">Loading a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_tube.html#setting-the-simulation-parameters">Setting the simulation parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_tube.html#running-the-simulation">Running the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_tube.html#analyzing-the-results">Analyzing the results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="competition_assay.html">Two-species competition assay</a><ul>
<li class="toctree-l2"><a class="reference internal" href="competition_assay.html#load-models-and-create-a-mutant">Load models and create a mutant</a></li>
<li class="toctree-l2"><a class="reference internal" href="competition_assay.html#create-layout-add-models-and-set-up-media-composition">Create layout, add models and set up media composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="competition_assay.html#set-up-simulation-parameters">Set up simulation parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="competition_assay.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="competition_assay.html#simulating-serial-transfers">Simulating serial transfers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="citrate.html">Citrate utilization in the Long Term Evolution Experiment.</a></li>
<li class="toctree-l1"><a class="reference internal" href="chemostat.html">Crossfeeding in a chemostat</a></li>
<li class="toctree-l1"><a class="reference internal" href="evolution.html">Simulating evolution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="evolution.html#load-the-model">Load the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="evolution.html#set-up-the-layout">Set up the layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="evolution.html#set-up-simulation-parameters">Set up simulation parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="evolution.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="evolution.html#visualize-the-results">Visualize the results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="circular_colony.html">Growth of a circular colony</a></li>
<li class="toctree-l1"><a class="reference internal" href="branching_colony.html">Growth of a branching colony</a></li>
<li class="toctree-l1"><a class="reference internal" href="demographic_noise_two_strains.html">Growth and propagation of bacterial colonies on flat surfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="petri_dish.html">Simulating growth on Petri dish</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Soil-air interface</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">COMETSpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Soil-air interface</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/soil.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="soil-air-interface">
<h1>Soil-air interface<a class="headerlink" href="#soil-air-interface" title="Link to this heading">ÔÉÅ</a></h1>
<p>Using the functionality of COMETS, one can design simulations which go beyond in silico corollaries of lab experiments to make predictions for environments mimicking natural ecosystems, which is a necessary step for understanding natural ecology from first principles. In this example, we consider a simulation of a soil environment. We use source-and-sink functions to model how a root provides organic acids to the environment while removing ammonia (Huang et al 2014 Botany). While we restrict the root functionality to a source/sink, one could use functionality demonstrated above, for example extracellular enzymes, to generate feedback loops between microbe-produced metabolites and root exudation. We use fixed metabolite concentrations to mimic the largely unchanging air interface above a root, which generates an oxygen gradient. Additionally, since soil is characterized by strong spatial structure with many impenetrable barriers that localized interactions (Nunan 2017), we place ‚Äúrock‚Äù barriers throughout the simulation area. A more complex simulation could use varying diffusion constants for metabolites, as described in a previous protocol (Virtual Petri Dish). Similarly, we use standard diffusion of biomass, but this could be changed to use pushing force or non-linear diffusion for a potentially increased realism.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cobra</span>
<span class="kn">import</span> <span class="nn">cobra.test</span> <span class="c1"># for the ijo1366 model</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/home/jeremy/Dropbox/work_related/harcombe_lab/segre/cometspy&quot;</span><span class="p">)</span> <span class="c1"># not necessary if you pip install cometspy</span>
<span class="kn">import</span> <span class="nn">cometspy</span> <span class="k">as</span> <span class="nn">c</span>
</pre></div>
</div>
<p>For the strain models, we use three well-curated soil bacteria, Pseudomonas putida (model iJN747), Bacillus subtilis (model iYO844), and Methanosarcina barkeri (model iAF629), which are available in the BIGG database (King et al 2016).</p>
<p>Also, upon loading, the biomass functions of these models had positive lower bounds, which we then set to zero.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_dir</span> <span class="o">=</span> <span class="s2">&quot;./models&quot;</span> <span class="c1"># model location</span>
<span class="n">iJN</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_sbml_model</span><span class="p">(</span><span class="n">model_dir</span> <span class="o">+</span> <span class="s1">&#39;/iJN746.xml&#39;</span><span class="p">)</span>
<span class="n">iJN</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="s1">&#39;BIOMASS_KT_TEMP&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">iJN</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="s1">&#39;BIOMASS_KT_TEMP&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">iAF</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_sbml_model</span><span class="p">(</span><span class="n">model_dir</span> <span class="o">+</span> <span class="s1">&#39;/iAF692.xml&#39;</span><span class="p">)</span>
<span class="n">iAF</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="s1">&#39;BIOMASS_Mb_30&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">iAF</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="s1">&#39;BIOMASS_Mb_30&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">iYO</span> <span class="o">=</span> <span class="n">cobra</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_sbml_model</span><span class="p">(</span><span class="n">model_dir</span> <span class="o">+</span> <span class="s1">&#39;/iYO844.xml&#39;</span><span class="p">)</span>
<span class="n">iYO</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="s1">&#39;BIOMASS_BS_10&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">iYO</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="s1">&#39;BIOMASS_BS_10&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>Next, we convert these into COMETS models. We also use some helper functions to a) ensure the COMETS model does not think ‚Äúsink‚Äù reactions are exchange reactions (as they are unbalanced in Cobra models, and therefore appear similar to exchanges), and b) open all exchange reaction bounds, to make sure that COMETS is in control of the media composition.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iJN_comets</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">iJN</span><span class="p">)</span>
<span class="n">iJN_comets</span><span class="o">.</span><span class="n">ensure_sinks_are_not_exchanges</span><span class="p">()</span>
<span class="n">iJN_comets</span><span class="o">.</span><span class="n">open_exchanges</span><span class="p">()</span>

<span class="n">iAF_comets</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">iAF</span><span class="p">)</span>
<span class="n">iAF_comets</span><span class="o">.</span><span class="n">ensure_sinks_are_not_exchanges</span><span class="p">()</span>
<span class="n">iAF_comets</span><span class="o">.</span><span class="n">open_exchanges</span><span class="p">()</span>

<span class="n">iYO_comets</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">iYO</span><span class="p">)</span>
<span class="n">iYO_comets</span><span class="o">.</span><span class="n">ensure_sinks_are_not_exchanges</span><span class="p">()</span>
<span class="n">iYO_comets</span><span class="o">.</span><span class="n">open_exchanges</span><span class="p">()</span>
</pre></div>
</div>
<p>Our simulated world will be a 100x100 box lattice. The left-hand side, where x = 0, will be the root. The top, where y = 0, will be the air. Therefore, the biomass and the rocks will be distributed everywhere else. To ensure that we don‚Äôt attempt to place biomass where rocks are placed, we first determine the rock locations. Specifically, we will create 70 rocks which are impervious to any biomass or metabolite. These rocks will have an average size of 15 boxes. To pick these locations, we use the helper function grow_rocks, in the utils subpackage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cometspy.utils</span> <span class="kn">import</span> <span class="n">grow_rocks</span><span class="p">,</span> <span class="n">pick_random_locations</span>

<span class="n">grid_size</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># 100</span>
<span class="n">n_rocks</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># 70</span>
<span class="n">rock_locs</span> <span class="o">=</span> <span class="n">grow_rocks</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">n_rocks</span><span class="p">,</span> <span class="n">xrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">mean_size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Each species will have biomass seeded at 60 different locations, with no overlap. We will use the helper function pick_random_locations for this, which is useful as it can take in a previously-generated list of tuples of x-y locations as ‚Äúforbidden‚Äù locations, such as the rock locations.</p>
<p>First we make a copy of the rock_locs so we don‚Äôt accidentally alter it, and call this copy forbidden_locs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="n">forbidden_locs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rock_locs</span><span class="p">)</span>
</pre></div>
</div>
<p>Next we pick the random locations for each species, adding these locations to the forbidden locs as we go so as to prevent overlap.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">founders_per_species</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># 60</span>
<span class="n">iJN_locs</span> <span class="o">=</span> <span class="n">pick_random_locations</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">founders_per_species</span><span class="p">,</span> 
                                   <span class="n">xrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="p">],</span> <span class="n">yrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="p">],</span> 
                                   <span class="n">forbidden_locs</span> <span class="o">=</span> <span class="n">forbidden_locs</span><span class="p">)</span>
<span class="n">forbidden_locs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iJN_locs</span><span class="p">)</span>
<span class="n">iYO_locs</span> <span class="o">=</span> <span class="n">pick_random_locations</span><span class="p">(</span><span class="n">founders_per_species</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="p">],</span> <span class="n">forbidden_locs</span><span class="p">)</span>
<span class="n">forbidden_locs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iYO_locs</span><span class="p">)</span>
<span class="n">iAF_locs</span> <span class="o">=</span> <span class="n">pick_random_locations</span><span class="p">(</span><span class="n">founders_per_species</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="n">grid_size</span><span class="p">],</span> <span class="n">forbidden_locs</span><span class="p">)</span>
<span class="n">forbidden_locs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">iAF_locs</span><span class="p">)</span>
</pre></div>
</div>
<p>If we wish to take a look at what locations were chosen, we can easily make an image with matplotlib:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">initial_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">grid_size</span><span class="p">,</span><span class="n">grid_size</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">rock</span> <span class="ow">in</span> <span class="n">rock_locs</span><span class="p">:</span>
    <span class="n">initial_image</span><span class="p">[</span><span class="n">rock</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rock</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> 
<span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">iJN_locs</span><span class="p">:</span>
    <span class="n">initial_image</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">iYO_locs</span><span class="p">:</span>
    <span class="n">initial_image</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">iAF_locs</span><span class="p">:</span>
    <span class="n">initial_image</span><span class="p">[</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">initial_image</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/soil_1.png" /></p>
<p>Things look good so we continue by making the layout and setting the dimensions. Then, we add the rock barriers to the layout.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
<span class="n">layout</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="p">[</span><span class="n">grid_size</span><span class="p">,</span><span class="n">grid_size</span><span class="p">]</span>
<span class="n">layout</span><span class="o">.</span><span class="n">add_barriers</span><span class="p">(</span><span class="n">rock_locs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>building empty layout model
models will need to be added with layout.add_model()
</pre></div>
</div>
<p>We set the initial population for each species by using a python list comprehension. Note that locations are properties of the model.</p>
<p>After setting initial populations, the models are finished, so we add them to the layout.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iJN_comets</span><span class="o">.</span><span class="n">initial_pop</span> <span class="o">=</span> <span class="p">[[</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mf">1e-8</span><span class="p">]</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">iJN_locs</span><span class="p">]</span>
<span class="n">iYO_comets</span><span class="o">.</span><span class="n">initial_pop</span> <span class="o">=</span> <span class="p">[[</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mf">1e-8</span><span class="p">]</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">iYO_locs</span><span class="p">]</span>
<span class="n">iAF_comets</span><span class="o">.</span><span class="n">initial_pop</span> <span class="o">=</span> <span class="p">[[</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mf">1e-8</span><span class="p">]</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">iAF_locs</span><span class="p">]</span>

<span class="n">layout</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">iJN_comets</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">iYO_comets</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">iAF_comets</span><span class="p">)</span>
</pre></div>
</div>
<p>We want some metabolites available initially. These include all the typical trace nutrients needed, so we start with the helper function.</p>
<p>After that, however, we want oxygen to mostly diffuse from the air, so we set that value lower. We also add a few other trace metabolites homogeneously throughout the environment that were not added with the helper function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span><span class="o">.</span><span class="n">add_typical_trace_metabolites</span><span class="p">()</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;o2_e&#39;</span><span class="p">,</span><span class="mf">0.00001</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;hco3_e&#39;</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;co2_e&#39;</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;h2_e&#39;</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;so3_e&#39;</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;nh4_e&#39;</span><span class="p">,</span><span class="mf">0.000001</span><span class="p">)</span>

<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;glc__D_e&#39;</span><span class="p">,</span><span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;meoh_e&#39;</span><span class="p">,</span><span class="mf">0.00000001</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;cys__L_e&#39;</span><span class="p">,</span><span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;4abz_e&#39;</span><span class="p">,</span><span class="mf">0.0000001</span><span class="p">)</span>
<span class="n">layout</span><span class="o">.</span><span class="n">set_specific_metabolite</span><span class="p">(</span><span class="s1">&#39;nac_e&#39;</span><span class="p">,</span><span class="mf">0.00000001</span><span class="p">)</span>
</pre></div>
</div>
<p>To make the air layer, we set static media, which keep that metabolite at a fixed value.  We also set a static level of zero oxygen at the ‚Äúbottom,‚Äù to mimic continuous downwards diffusion.</p>
<p>In a similar fashion, we set a static sink of ammonium where the ‚Äúroot‚Äù is.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># set static media of O2 and CO2 at the top and bottom-- the &quot;air&quot; and continuous loss of O2 downwards</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">):</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_specific_static_at_location</span><span class="p">(</span><span class="s1">&#39;o2_e&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mf">.0001</span><span class="p">)</span> <span class="c1"># top</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_specific_static_at_location</span><span class="p">(</span><span class="s1">&#39;o2_e&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">grid_size</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span> <span class="c1"># bottom</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_specific_static_at_location</span><span class="p">(</span><span class="s1">&#39;co2_e&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mf">.0001</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">):</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_specific_static_at_location</span><span class="p">(</span><span class="s1">&#39;nh4_e&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<p>In contrast to ammonia, which we assume is always entirely consumed by the root, we assume the root drips organic acids and methanol into the environment at fixed rate, so we use a refresh function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">):</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_specific_refresh_at_location</span><span class="p">(</span><span class="s1">&#39;cit_e&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="mf">.000001</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_specific_refresh_at_location</span><span class="p">(</span><span class="s1">&#39;meoh_e&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="mf">.000001</span><span class="p">)</span>
    <span class="n">layout</span><span class="o">.</span><span class="n">set_specific_refresh_at_location</span><span class="p">(</span><span class="s1">&#39;succ_e&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="mf">.000001</span><span class="p">)</span>
</pre></div>
</div>
<p>We are now done prepping the models and the layout. Next we setup the simulation parameters. Note the positive death rate.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">params</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;timeStep&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;maxCycles&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;maxSpaceBiomass&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;deathRate&#39;</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="c1"># die at rate of 1/10000 per hour</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;writeBiomassLog&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;BiomassLogRate&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;writeMediaLog&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;MediaLogRate&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s2">&quot;writeFluxLog&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s2">&quot;FluxLogRate&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;numRunThreads&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">params</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span><span class="s1">&#39;defaultKm&#39;</span><span class="p">,</span> <span class="mf">0.000001</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">comets</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># give the argument False if you want to save all intermediate files</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Running COMETS simulation ...
Done!
</pre></div>
</div>
<p>Now we make a biomass image using the get_biomass_image helper function. We put these into a 3D numpy array to visualize with matplotlib.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">im</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_biomass_image</span><span class="p">(</span><span class="s1">&#39;iJN746&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">all_params</span><span class="p">[</span><span class="s1">&#39;maxCycles&#39;</span><span class="p">])</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_biomass_image</span><span class="p">(</span><span class="s1">&#39;iYO844&#39;</span><span class="p">,</span><span class="n">params</span><span class="o">.</span><span class="n">all_params</span><span class="p">[</span><span class="s1">&#39;maxCycles&#39;</span><span class="p">])</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_biomass_image</span><span class="p">(</span><span class="s1">&#39;iAF692&#39;</span><span class="p">,</span><span class="n">params</span><span class="o">.</span><span class="n">all_params</span><span class="p">[</span><span class="s1">&#39;maxCycles&#39;</span><span class="p">])</span>

<span class="n">final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">grid_size</span><span class="p">,</span><span class="n">grid_size</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">final</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">im</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">final</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">im2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">im2</span><span class="p">)</span>
<span class="n">final</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">im3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">im3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rock</span> <span class="ow">in</span> <span class="n">rock_locs</span><span class="p">:</span>
    <span class="n">final</span><span class="p">[</span><span class="n">rock</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rock</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> 
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">final</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/soil_2.png" /></p>
<p>Below here, we show a handful of metabolites.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">get_metabolite_image</span><span class="p">(</span><span class="s2">&quot;succ_e&quot;</span><span class="p">,</span><span class="n">params</span><span class="o">.</span><span class="n">all_params</span><span class="p">[</span><span class="s1">&#39;maxCycles&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p><img alt="" src="_images/soil_3.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">get_metabolite_image</span><span class="p">(</span><span class="s2">&quot;ac_e&quot;</span><span class="p">,</span><span class="n">params</span><span class="o">.</span><span class="n">all_params</span><span class="p">[</span><span class="s1">&#39;maxCycles&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p><img alt="" src="_images/soil_4.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">get_metabolite_image</span><span class="p">(</span><span class="s2">&quot;nh4_e&quot;</span><span class="p">,</span><span class="n">params</span><span class="o">.</span><span class="n">all_params</span><span class="p">[</span><span class="s1">&#39;maxCycles&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p><img alt="" src="_images/soil_5.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="petri_dish.html" class="btn btn-neutral float-left" title="Simulating growth on Petri dish" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, The Segre Lab at Boston University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>